FROM node:18-alpine

ARG NEXT_PUBLIC_AUTH_API_URL
ARG NEXT_PUBLIC_PROFILE_API_URL
ARG NEXT_PUBLIC_TASK_API_URL

# Set as environment variables
ENV NEXT_PUBLIC_AUTH_API_URL=$NEXT_PUBLIC_AUTH_API_URL
ENV NEXT_PUBLIC_PROFILE_API_URL=$NEXT_PUBLIC_PROFILE_API_URL
ENV NEXT_PUBLIC_TASK_API_URL=$NEXT_PUBLIC_TASK_API_URL

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

# Inject the env vars during build
RUN NEXT_PUBLIC_AUTH_API_URL=$NEXT_PUBLIC_AUTH_API_URL \
    NEXT_PUBLIC_PROFILE_API_URL=$NEXT_PUBLIC_PROFILE_API_URL \
    NEXT_PUBLIC_TASK_API_URL=$NEXT_PUBLIC_TASK_API_URL \
    npm run build

EXPOSE 3000

CMD ["npm", "start"]
